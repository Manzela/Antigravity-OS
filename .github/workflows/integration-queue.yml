name: Self-Healing Integration Queue (Rule 4.3)
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  validate-and-heal:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Integration Test
        id: test
        run: |
          ./scripts/run_integration_suite.sh || echo "status=fail" >> $GITHUB_OUTPUT

      - name: Self-Healing Rollback
        if: steps.test.outputs.status == 'fail'
        run: |
          echo "[HEAL] Reverting commit..."
          git config user.email "manzela@tngshopper.com"
          git config user.name "Antigravity CI"
          git revert HEAD --no-edit
          # In real life, push back or close PR
