version: '3.8'
services:
  # THE MEMORY (State & Deduplication)
  # UPGRADE: Locked to Redis 7.2 Alpine to fix "RDB format version 11" error
  antigravity-brain:
    image: redis:7.2-alpine
    container_name: antigravity-brain
    ports:
      - "127.0.0.1:6379:6379"
    env_file:
      - .env
    volumes:
      - brain_data:/data
    restart: always

  # THE CONSCIENCE (Policy Engine)
  antigravity-sentinel:
    image: openpolicyagent/opa:latest
    container_name: antigravity-sentinel
    ports:
      - "127.0.0.1:8181:8181"
    volumes:
      - ./.agent/policies:/policies
    command: ["run", "--server", "--addr=0.0.0.0:8181", "/policies"]

volumes:
  brain_data:
